{"id":"orders","metainfo":{"label":"orders","finalProcessID":"final##LFMeD2YR","autoLayout":false,"staleState":"none","sourceSuggestions":{"sources":[]},"graphConfig":{"userDefinedConfig":{"vars":{"payment_methods":"['credit_card', 'coupon', 'bank_transfer', 'gift_card']"}}}},"processes":{"orders##hx53Bz72":{"id":"orders##hx53Bz72","component":"Model","metadata":{"label":"orders","x":320,"y":120,"phase":0},"properties":{"table":{"name":"stg_orders","sourceType":"Model"}},"ports":{"inputs":[],"outputs":[{"id":"qJn31Jo8","schema":{"providerType":"Snowflake","fields":[{"name":"ORDER_ID","dataType":{"type":"Number"}},{"name":"CUSTOMER_ID","dataType":{"type":"Number"}},{"name":"ORDER_DATE","dataType":{"type":"Date"}},{"name":"STATUS","dataType":{"type":"String"}}]},"slug":"out"}],"isCustomOutputSchema":false}},"payments##DheICe6Y":{"id":"payments##DheICe6Y","component":"Model","metadata":{"label":"payments","x":120,"y":320,"phase":0},"properties":{"table":{"name":"stg_payments","sourceType":"Model"}},"ports":{"inputs":[],"outputs":[{"id":"ZZn3gqjc","schema":{"providerType":"Snowflake","fields":[{"name":"PAYMENT_ID","dataType":{"type":"Number"}},{"name":"ORDER_ID","dataType":{"type":"Number"}},{"name":"PAYMENT_METHOD","dataType":{"type":"String"}},{"name":"AMOUNT","dataType":{"type":"Decimal","precision":38,"scale":6}}]},"slug":"out"}],"isCustomOutputSchema":false}},"order_payments##ytkWzgAQ":{"id":"order_payments##ytkWzgAQ","component":"Aggregate","metadata":{"label":"order_payments","x":320,"y":320,"phase":0,"macroDependencies":[]},"properties":{"aggregate":[{"expression":{"expression":"order_id"}},{"rowType":"for","variable":{"expression":"payment_method"},"iterable":{"expression":"payment_methods"},"children":[{"expression":{"expression":"sum(CASE\n  WHEN payment_method = '{{ payment_method }}'\n    THEN amount\n  ELSE 0\nEND)"},"alias":"{{payment_method}}_amount"}]},{"expression":{"expression":"sum(amount)"},"alias":"total_amount"}],"allowSelection":true,"condition":{"expression":""},"activeTab":"aggregate","columnsSelector":[],"groupBy":[{"expression":{"expression":"order_id"}}]},"ports":{"inputs":[{"id":"HbRBGQ00","schema":{"providerType":"Snowflake","fields":[{"name":"PAYMENT_ID","dataType":{"type":"Number"}},{"name":"ORDER_ID","dataType":{"type":"Number"}},{"name":"PAYMENT_METHOD","dataType":{"type":"String"}},{"name":"AMOUNT","dataType":{"type":"Decimal","precision":38,"scale":6}}]},"slug":"payments"}],"outputs":[{"id":"doeCN6S9","schema":{"providerType":"Snowflake","fields":[{"name":"ORDER_ID","dataType":{"type":"Number"}},{"name":"CREDIT_CARD_AMOUNT","dataType":{"type":"Decimal","precision":38,"scale":6}},{"name":"COUPON_AMOUNT","dataType":{"type":"Decimal","precision":38,"scale":6}},{"name":"BANK_TRANSFER_AMOUNT","dataType":{"type":"Decimal","precision":38,"scale":6}},{"name":"GIFT_CARD_AMOUNT","dataType":{"type":"Decimal","precision":38,"scale":6}},{"name":"TOTAL_AMOUNT","dataType":{"type":"Decimal","precision":38,"scale":6}}]},"slug":"out"}],"isCustomOutputSchema":false}},"final##LFMeD2YR":{"id":"final##LFMeD2YR","component":"Join","metadata":{"label":"final","x":520,"y":220,"phase":0,"macroDependencies":[]},"properties":{"conditions":[{"alias":"order_payments","expression":{"expression":"orders.order_id = order_payments.order_id"},"joinType":"LEFT"}],"expressions":[{"expression":{"expression":"orders.order_id"}},{"expression":{"expression":"orders.customer_id"}},{"expression":{"expression":"orders.order_date"}},{"expression":{"expression":"orders.status"}},{"rowType":"for","variable":{"expression":"payment_method"},"iterable":{"expression":"payment_methods"},"children":[{"expression":{"expression":"order_payments.{{payment_method}}_amount"}}]},{"expression":{"expression":"order_payments.total_amount"},"alias":"amount"}],"activeTab":"conditions","columnsSelector":[],"headAlias":"orders"},"ports":{"inputs":[{"id":"a4bjB08W","schema":{"providerType":"Snowflake","fields":[{"name":"ORDER_ID","dataType":{"type":"Number"}},{"name":"CUSTOMER_ID","dataType":{"type":"Number"}},{"name":"ORDER_DATE","dataType":{"type":"Date"}},{"name":"STATUS","dataType":{"type":"String"}}]},"slug":"orders"},{"id":"oCY8Nwbx","schema":{"providerType":"Snowflake","fields":[{"name":"ORDER_ID","dataType":{"type":"Number"}},{"name":"CREDIT_CARD_AMOUNT","dataType":{"type":"Decimal","precision":38,"scale":6}},{"name":"COUPON_AMOUNT","dataType":{"type":"Decimal","precision":38,"scale":6}},{"name":"BANK_TRANSFER_AMOUNT","dataType":{"type":"Decimal","precision":38,"scale":6}},{"name":"GIFT_CARD_AMOUNT","dataType":{"type":"Decimal","precision":38,"scale":6}},{"name":"TOTAL_AMOUNT","dataType":{"type":"Decimal","precision":38,"scale":6}}]},"slug":"order_payments"}],"outputs":[{"id":"QnHu3LcI","schema":{"providerType":"Snowflake","fields":[{"name":"ORDER_ID","dataType":{"type":"Number"}},{"name":"CUSTOMER_ID","dataType":{"type":"Number"}},{"name":"ORDER_DATE","dataType":{"type":"Date"}},{"name":"STATUS","dataType":{"type":"String"}},{"name":"CREDIT_CARD_AMOUNT","dataType":{"type":"Decimal","precision":38,"scale":6}},{"name":"COUPON_AMOUNT","dataType":{"type":"Decimal","precision":38,"scale":6}},{"name":"BANK_TRANSFER_AMOUNT","dataType":{"type":"Decimal","precision":38,"scale":6}},{"name":"GIFT_CARD_AMOUNT","dataType":{"type":"Decimal","precision":38,"scale":6}},{"name":"AMOUNT","dataType":{"type":"Decimal","precision":38,"scale":6}}]},"slug":"out"}],"isCustomOutputSchema":false}}},"connections":[{"id":"yUPR5wz8","source":"payments##DheICe6Y","sourcePort":"ZZn3gqjc","target":"order_payments##ytkWzgAQ","targetPort":"HbRBGQ00"},{"id":"dxW3VV7u","source":"orders##hx53Bz72","sourcePort":"qJn31Jo8","target":"final##LFMeD2YR","targetPort":"a4bjB08W"},{"id":"hkTQErLM","source":"order_payments##ytkWzgAQ","sourcePort":"doeCN6S9","target":"final##LFMeD2YR","targetPort":"oCY8Nwbx"}],"component":"Model"}